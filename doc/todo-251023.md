# TODO List - 2025ë…„ 10ì›” 23ì¼

## ğŸ“‹ ìš”êµ¬ì‚¬í•­ ìš”ì•½
1. ë¶„ì„ ì¤‘ ë¡œë”© ì¸ë””ì¼€ì´í„° ë° ì‹œê°„ ì•ˆë‚´ ë©”ì‹œì§€ ì¶”ê°€
2. ì‚¬ìš©ì ì •ë³´ í…Œì´ë¸”ì— ë¶„ì„ê°€ëŠ¥ íšŸìˆ˜ ë° í”Œëœ ì»¬ëŸ¼ ì¶”ê°€
3. ìš°ì¸¡ ìƒë‹¨ì— 'ë‚´ì •ë³´' ë²„íŠ¼ ì¶”ê°€
4. 'ë‚´ì •ë³´' í˜ì´ì§€ êµ¬í˜„ (ì´ë©”ì¼, ë¶„ì„ê°€ëŠ¥íšŸìˆ˜, í”Œëœ í‘œì‹œ)

---

## ğŸ¯ Phase 1: ë¶„ì„ ì¤‘ ë¡œë”© UI ê°œì„ 

### 1.1 ë¡œë”© ì¸ë””ì¼€ì´í„° ì»´í¬ë„ŒíŠ¸ ì¶”ê°€
- [x] `src/app/analyze/page.tsx` ìˆ˜ì •
  - ë¶„ì„ ì¤‘ ìƒíƒœì¼ ë•Œ ë¡œë”© ìŠ¤í”¼ë„ˆ í‘œì‹œ
  - "ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤. ìµœëŒ€ 3ë¶„ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤." ë©”ì‹œì§€ ì¶”ê°€
  - ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ì¶”ê°€
  
  ```tsx
  {isLoading && (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
      <div className="bg-white p-8 rounded-lg shadow-xl text-center">
        <div className="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto mb-4"></div>
        <h3 className="text-xl font-semibold mb-2">ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤</h3>
        <p className="text-gray-600">ìµœëŒ€ 3ë¶„ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      </div>
    </div>
  )}
  ```

---

## ğŸ¯ Phase 2: ì‚¬ìš©ì ì •ë³´ í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ í™•ì¥

### 2.1 Supabase ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìˆ˜ì •
- [ ] **users í…Œì´ë¸”ì— ì»¬ëŸ¼ ì¶”ê°€**
  ```sql
  -- users í…Œì´ë¸”ì— ìƒˆë¡œìš´ ì»¬ëŸ¼ ì¶”ê°€
  ALTER TABLE users 
  ADD COLUMN IF NOT EXISTS analysis_count INTEGER DEFAULT 10,
  ADD COLUMN IF NOT EXISTS plan VARCHAR(20) DEFAULT 'free' CHECK (plan IN ('free', 'paid'));
  
  -- ì»¬ëŸ¼ ì¸ë±ìŠ¤ ì¶”ê°€
  CREATE INDEX IF NOT EXISTS idx_users_plan ON users(plan);
  
  -- ì»¬ëŸ¼ ì½”ë©˜íŠ¸ ì¶”ê°€
  COMMENT ON COLUMN users.analysis_count IS 'ë‚¨ì€ ë¶„ì„ ê°€ëŠ¥ íšŸìˆ˜';
  COMMENT ON COLUMN users.plan IS 'ì‚¬ìš©ì í”Œëœ (free: ë¬´ë£Œ, paid: ìœ ë£Œ)';
  ```

### 2.2 TypeScript íƒ€ì… ì—…ë°ì´íŠ¸
- [ ] `src/lib/supabase/users.ts` ìˆ˜ì •
  - User ì¸í„°í˜ì´ìŠ¤ì— `analysis_count`, `plan` í•„ë“œ ì¶”ê°€
  
  ```typescript
  export interface User {
    id?: string;
    email: string;
    provider: string;
    provider_account_id: string;
    name?: string;
    analysis_count?: number; // ì¶”ê°€
    plan?: 'free' | 'paid';   // ì¶”ê°€
    created_at?: string;
    updated_at?: string;
    last_login_at?: string;
  }
  ```

### 2.3 ì‚¬ìš©ì ìƒì„± ì‹œ ê¸°ë³¸ê°’ ì„¤ì •
- [ ] `src/lib/supabase/users.ts` - `upsertUser()` í•¨ìˆ˜ ìˆ˜ì •
  - ì‹ ê·œ ì‚¬ìš©ì ìƒì„± ì‹œ `analysis_count: 10`, `plan: 'free'` ê¸°ë³¸ê°’ ì„¤ì •

### 2.4 ë¶„ì„ íšŸìˆ˜ ì°¨ê° ë¡œì§ ì¶”ê°€
- [ ] `src/lib/supabase/users.ts`ì— ìƒˆë¡œìš´ í•¨ìˆ˜ ì¶”ê°€
  - `decrementAnalysisCount(email)` - ë¶„ì„ íšŸìˆ˜ 1 ì°¨ê°
  - `getAnalysisCount(email)` - ë‚¨ì€ ë¶„ì„ íšŸìˆ˜ ì¡°íšŒ
  
  ```typescript
  /**
   * ë¶„ì„ íšŸìˆ˜ ì°¨ê°
   */
  export async function decrementAnalysisCount(email: string) {
    const supabase = getServerSupabase();
    
    const { data, error } = await supabase
      .from('users')
      .update({ 
        analysis_count: supabase.raw('analysis_count - 1'),
        updated_at: new Date().toISOString()
      })
      .eq('email', email)
      .select()
      .single();
    
    if (error) throw error;
    return data;
  }
  ```

### 2.5 ë¶„ì„ ì‹¤í–‰ ì „ íšŸìˆ˜ ì²´í¬
- [ ] `src/app/analyze/page.tsx` ìˆ˜ì •
  - `handleSubmit()` í•¨ìˆ˜ì—ì„œ ë¶„ì„ ì‹¤í–‰ ì „ `analysis_count` í™•ì¸
  - íšŸìˆ˜ê°€ 0ì´ë©´ "ë¶„ì„ ê°€ëŠ¥ íšŸìˆ˜ë¥¼ ëª¨ë‘ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤" ì—ëŸ¬ í‘œì‹œ
  - ë¶„ì„ ì„±ê³µ ì‹œ íšŸìˆ˜ ì°¨ê° API í˜¸ì¶œ

---

## ğŸ¯ Phase 3: 'ë‚´ì •ë³´' ë²„íŠ¼ ì¶”ê°€

### 3.1 AuthHeader ì»´í¬ë„ŒíŠ¸ ìˆ˜ì •
- [ ] `src/components/AuthHeader.tsx` ìˆ˜ì •
  - ë¡œê·¸ì¸ ìƒíƒœì¼ ë•Œ 'ë‚´ì •ë³´' ë²„íŠ¼ ì¶”ê°€
  - 'ë‚´ì •ë³´' ë²„íŠ¼ í´ë¦­ ì‹œ `/profile` í˜ì´ì§€ë¡œ ì´ë™
  
  ```tsx
  {session && (
    <>
      <Link href="/profile">
        <Button variant="outline">ë‚´ì •ë³´</Button>
      </Link>
      <Button onClick={() => signOut()}>ë¡œê·¸ì•„ì›ƒ</Button>
    </>
  )}
  ```

---

## ğŸ¯ Phase 4: 'ë‚´ì •ë³´' í˜ì´ì§€ êµ¬í˜„

### 4.1 í”„ë¡œí•„ í˜ì´ì§€ ìƒì„±
- [ ] `src/app/profile/page.tsx` ìƒì„±
  - ë¡œê·¸ì¸ í™•ì¸ (ë¯¸ë¡œê·¸ì¸ ì‹œ í™ˆìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸)
  - ì‚¬ìš©ì ì •ë³´ API í˜¸ì¶œ
  - ì´ë©”ì¼, ë¶„ì„ê°€ëŠ¥íšŸìˆ˜, í”Œëœ í‘œì‹œ
  
  ```tsx
  'use client';
  
  import { useSession } from 'next-auth/react';
  import { useEffect, useState } from 'react';
  import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
  import { useRouter } from 'next/navigation';
  
  export default function ProfilePage() {
    const { data: session, status } = useSession();
    const router = useRouter();
    const [userInfo, setUserInfo] = useState(null);
    const [loading, setLoading] = useState(true);
    
    useEffect(() => {
      if (status === 'unauthenticated') {
        router.push('/');
      }
    }, [status, router]);
    
    useEffect(() => {
      if (session?.user?.email) {
        fetchUserInfo();
      }
    }, [session]);
    
    const fetchUserInfo = async () => {
      try {
        const res = await fetch('/api/user/profile');
        const data = await res.json();
        setUserInfo(data.user);
      } catch (error) {
        console.error('Failed to fetch user info:', error);
      } finally {
        setLoading(false);
      }
    };
    
    return (
      <div className="max-w-2xl mx-auto p-6">
        <Card>
          <CardHeader>
            <CardTitle>ë‚´ì •ë³´</CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <div>
              <label className="font-semibold">ì´ë©”ì¼</label>
              <p>{userInfo?.email}</p>
            </div>
            <div>
              <label className="font-semibold">ë¶„ì„ê°€ëŠ¥ íšŸìˆ˜</label>
              <p>{userInfo?.analysis_count}íšŒ</p>
            </div>
            <div>
              <label className="font-semibold">í”Œëœ</label>
              <p>{userInfo?.plan === 'paid' ? 'ìœ ë£Œ' : 'ë¬´ë£Œ'}</p>
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }
  ```

### 4.2 í”„ë¡œí•„ API ì—”ë“œí¬ì¸íŠ¸ ìƒì„±
- [ ] `src/app/api/user/profile/route.ts` ìƒì„±
  - GET: ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ ì •ë³´ ì¡°íšŒ
  - ì´ë©”ì¼, analysis_count, plan ë°˜í™˜
  
  ```typescript
  import { NextResponse } from 'next/server';
  import { getServerSession } from 'next-auth';
  import { authOptions } from '@/auth';
  import { getUserByEmail } from '@/lib/supabase/users';
  
  export async function GET() {
    try {
      const session = await getServerSession(authOptions);
      
      if (!session?.user?.email) {
        return NextResponse.json(
          { error: 'Unauthorized' },
          { status: 401 }
        );
      }
      
      const user = await getUserByEmail(session.user.email);
      
      if (!user) {
        return NextResponse.json(
          { error: 'User not found' },
          { status: 404 }
        );
      }
      
      return NextResponse.json({
        success: true,
        user: {
          email: user.email,
          name: user.name,
          analysis_count: user.analysis_count,
          plan: user.plan,
        },
      });
    } catch (error: any) {
      return NextResponse.json(
        { error: 'Failed to fetch user profile', details: error.message },
        { status: 500 }
      );
    }
  }
  ```

### 4.3 ë¶„ì„ íšŸìˆ˜ ì°¨ê° API ì—”ë“œí¬ì¸íŠ¸ ìƒì„±
- [ ] `src/app/api/user/decrement-analysis/route.ts` ìƒì„±
  - POST: ë¶„ì„ íšŸìˆ˜ 1 ì°¨ê°
  - ë¡œê·¸ì¸ í•„ìš”
  
  ```typescript
  import { NextResponse } from 'next/server';
  import { getServerSession } from 'next-auth';
  import { authOptions } from '@/auth';
  import { decrementAnalysisCount } from '@/lib/supabase/users';
  
  export async function POST() {
    try {
      const session = await getServerSession(authOptions);
      
      if (!session?.user?.email) {
        return NextResponse.json(
          { error: 'Unauthorized' },
          { status: 401 }
        );
      }
      
      const updatedUser = await decrementAnalysisCount(session.user.email);
      
      return NextResponse.json({
        success: true,
        analysis_count: updatedUser.analysis_count,
      });
    } catch (error: any) {
      return NextResponse.json(
        { error: 'Failed to decrement analysis count', details: error.message },
        { status: 500 }
      );
    }
  }
  ```

---

## ğŸ¯ Phase 5: í†µí•© ë° í…ŒìŠ¤íŠ¸

### 5.1 ë¶„ì„ í˜ì´ì§€ ì™„ì „ í†µí•©
- [ ] `src/app/analyze/page.tsx` ìµœì¢… ìˆ˜ì •
  - ë¶„ì„ ì‹œì‘ ì „ íšŸìˆ˜ í™•ì¸
  - ë¡œë”© UI í‘œì‹œ
  - ë¶„ì„ ì„±ê³µ ì‹œ íšŸìˆ˜ ì°¨ê°
  - íšŸìˆ˜ 0ì¼ ë•Œ ì—ëŸ¬ ì²˜ë¦¬

### 5.2 ë„¤ë¹„ê²Œì´ì…˜ í…ŒìŠ¤íŠ¸
- [ ] 'ë‚´ì •ë³´' ë²„íŠ¼ í´ë¦­ â†’ í”„ë¡œí•„ í˜ì´ì§€ ì´ë™ í™•ì¸
- [ ] í”„ë¡œí•„ í˜ì´ì§€ì—ì„œ ì‚¬ìš©ì ì •ë³´ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸

### 5.3 ë¶„ì„ íšŸìˆ˜ ì°¨ê° í…ŒìŠ¤íŠ¸
- [ ] ë¶„ì„ ì‹¤í–‰ â†’ íšŸìˆ˜ ì°¨ê° í™•ì¸
- [ ] í”„ë¡œí•„ í˜ì´ì§€ì—ì„œ ì°¨ê°ëœ íšŸìˆ˜ í™•ì¸
- [ ] íšŸìˆ˜ 0ì¼ ë•Œ ë¶„ì„ ì°¨ë‹¨ í™•ì¸

### 5.4 UI/UX í…ŒìŠ¤íŠ¸
- [ ] ë¡œë”© ì¸ë””ì¼€ì´í„° ì• ë‹ˆë©”ì´ì…˜ í™•ì¸
- [ ] ë©”ì‹œì§€ ê°€ë…ì„± í™•ì¸
- [ ] ë°˜ì‘í˜• ë””ìì¸ í™•ì¸

---

## ğŸ¯ Phase 6: ì¶”ê°€ ê°œì„ ì‚¬í•­ (ì„ íƒì‚¬í•­)

### 6.1 ë¶„ì„ íšŸìˆ˜ ê´€ë¦¬
- [ ] ê´€ë¦¬ì ê¸°ëŠ¥: íŠ¹ì • ì‚¬ìš©ì íšŸìˆ˜ ì¶©ì „
- [ ] íšŸìˆ˜ êµ¬ë§¤ ê¸°ëŠ¥ ì¶”ê°€
- [ ] í”Œëœ ì—…ê·¸ë ˆì´ë“œ ê¸°ëŠ¥

### 6.2 ì•Œë¦¼ ê¸°ëŠ¥
- [ ] íšŸìˆ˜ê°€ 3íšŒ ì´í•˜ì¼ ë•Œ ê²½ê³  ë©”ì‹œì§€
- [ ] íšŸìˆ˜ê°€ 0ì¼ ë•Œ ì¶©ì „ ì•ˆë‚´ ë©”ì‹œì§€

### 6.3 íˆìŠ¤í† ë¦¬ ê¸°ëŠ¥
- [ ] í”„ë¡œí•„ í˜ì´ì§€ì— ìµœê·¼ ë¶„ì„ ì´ë ¥ í‘œì‹œ
- [ ] ì´ ë¶„ì„ íšŸìˆ˜ í†µê³„ í‘œì‹œ

---

## ğŸ“ ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸

```sql
-- users í…Œì´ë¸” ì»¬ëŸ¼ ì¶”ê°€ ìŠ¤í¬ë¦½íŠ¸
-- Supabase SQL Editorì—ì„œ ì‹¤í–‰

-- 1. ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE users 
ADD COLUMN IF NOT EXISTS analysis_count INTEGER DEFAULT 10,
ADD COLUMN IF NOT EXISTS plan VARCHAR(20) DEFAULT 'free' CHECK (plan IN ('free', 'paid'));

-- 2. ê¸°ì¡´ ì‚¬ìš©ì ë°ì´í„° ì—…ë°ì´íŠ¸ (ëª¨ë‘ ë¬´ë£Œ í”Œëœ, 10íšŒ ì œê³µ)
UPDATE users 
SET analysis_count = 10, 
    plan = 'free' 
WHERE analysis_count IS NULL OR plan IS NULL;

-- 3. NOT NULL ì œì•½ì¡°ê±´ ì¶”ê°€ (ì„ íƒì‚¬í•­)
-- ALTER TABLE users 
-- ALTER COLUMN analysis_count SET NOT NULL,
-- ALTER COLUMN plan SET NOT NULL;

-- 4. ì¸ë±ìŠ¤ ì¶”ê°€
CREATE INDEX IF NOT EXISTS idx_users_plan ON users(plan);
CREATE INDEX IF NOT EXISTS idx_users_analysis_count ON users(analysis_count);

-- 5. ì½”ë©˜íŠ¸ ì¶”ê°€
COMMENT ON COLUMN users.analysis_count IS 'ë‚¨ì€ ë¶„ì„ ê°€ëŠ¥ íšŸìˆ˜';
COMMENT ON COLUMN users.plan IS 'ì‚¬ìš©ì í”Œëœ (free: ë¬´ë£Œ, paid: ìœ ë£Œ)';

-- 6. í™•ì¸
SELECT email, analysis_count, plan FROM users LIMIT 10;
```

---

## âœ… ì™„ë£Œ ê¸°ì¤€

1. âœ… ë¶„ì„ ì‹œì‘ ì‹œ ë¡œë”© ì¸ë””ì¼€ì´í„°ì™€ "ìµœëŒ€ 3ë¶„ ì†Œìš”" ë©”ì‹œì§€ í‘œì‹œ
2. âœ… users í…Œì´ë¸”ì— `analysis_count`, `plan` ì»¬ëŸ¼ ì¶”ê°€
3. âœ… ìš°ì¸¡ ìƒë‹¨ì— 'ë‚´ì •ë³´' ë²„íŠ¼ ì¶”ê°€
4. âœ… 'ë‚´ì •ë³´' í˜ì´ì§€ì—ì„œ ì´ë©”ì¼, ë¶„ì„ê°€ëŠ¥íšŸìˆ˜, í”Œëœ í‘œì‹œ
5. âœ… ë¶„ì„ ì‹¤í–‰ ì‹œ íšŸìˆ˜ ì°¨ê° ê¸°ëŠ¥ ë™ì‘
6. âœ… íšŸìˆ˜ 0ì¼ ë•Œ ë¶„ì„ ì°¨ë‹¨ ê¸°ëŠ¥ ë™ì‘
7. âœ… ëª¨ë“  ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•¨ì„ í…ŒìŠ¤íŠ¸ë¡œ ê²€ì¦

---

## ğŸ“š ì°¸ê³  ìë£Œ
- [NextAuth.js Session Management](https://next-auth.js.org/getting-started/client#usesession)
- [Supabase SQL Functions](https://supabase.com/docs/guides/database/functions)
- [React Loading Spinners](https://tailwindcss.com/docs/animation)
