# 카카오 로그인 설정 가이드

## 개요
Smart Investor 앱에 카카오 로그인을 연동하는 방법을 안내합니다.

---

## 1. 카카오 개발자 앱 생성

### 1.1 카카오 개발자 콘솔 접속
1. https://developers.kakao.com 접속
2. 카카오 계정으로 로그인
3. 우측 상단 "내 애플리케이션" 클릭

### 1.2 애플리케이션 추가
1. "애플리케이션 추가하기" 버튼 클릭
2. 앱 정보 입력:
   - **앱 이름**: Smart Investor (또는 원하는 이름)
   - **사업자명**: 개인 또는 회사명
3. "저장" 클릭

---

## 2. 플랫폼 설정

### 2.1 Web 플랫폼 추가
1. 생성된 앱 선택
2. 좌측 메뉴에서 "플랫폼" 클릭
3. "Web 플랫폼 등록" 버튼 클릭
4. 사이트 도메인 입력:
   - **개발 환경**: `http://localhost:3000`
   - **프로덕션 환경**: 실제 배포 도메인 (예: `https://smart-investor.com`)
5. "저장" 클릭

---

## 3. 카카오 로그인 활성화

### 3.1 카카오 로그인 설정
1. 좌측 메뉴에서 "제품 설정 > 카카오 로그인" 클릭
2. "활성화 설정" 섹션:
   - **카카오 로그인 활성화** 토글 ON
3. "저장" 클릭

### 3.2 Redirect URI 등록
1. 같은 페이지에서 "Redirect URI" 섹션으로 스크롤
2. "Redirect URI 등록" 버튼 클릭
3. URI 입력:
   - **개발 환경**: `http://localhost:3000/api/auth/callback/kakao`
   - **프로덕션 환경**: `https://your-domain.com/api/auth/callback/kakao`
4. "저장" 클릭

⚠️ **중요**: Redirect URI는 정확히 일치해야 합니다. 후행 슬래시(`/`)도 확인하세요.

### 3.3 동의 항목 설정
1. 좌측 메뉴에서 "제품 설정 > 카카오 로그인 > 동의항목" 클릭
2. 필요한 정보 설정:
   - **이메일 (email)**: 필수 동의로 설정
   - **닉네임 (nickname)**: 선택 동의
   - **프로필 이미지 (profile_image)**: 선택 동의
3. "저장" 클릭

📌 **참고**: 
- 이메일을 필수로 설정해야 앱에서 사용자를 식별할 수 있습니다.
- 앱 심사 전에는 테스터로 등록된 카카오 계정만 사용할 수 있습니다.

---

## 4. API 키 확인

### 4.1 REST API 키 복사
1. 좌측 메뉴에서 "앱 설정 > 요약 정보" 클릭
2. "앱 키" 섹션에서 **REST API 키** 복사
3. 이 키가 `KAKAO_CLIENT_ID`로 사용됩니다.

### 4.2 Client Secret 생성
1. 좌측 메뉴에서 "제품 설정 > 카카오 로그인 > 보안" 클릭
2. "Client Secret" 섹션:
   - **코드 생성** 버튼 클릭
   - **활성화** 상태로 변경
   - 생성된 **코드** 복사
3. 이 값이 `KAKAO_CLIENT_SECRET`으로 사용됩니다.

⚠️ **보안 주의**: Client Secret은 절대 외부에 노출하면 안 됩니다!

---

## 5. 환경변수 설정

### 5.1 프론트엔드 환경변수
프로젝트 루트의 `.env.development` 파일을 수정:

```bash
# Kakao OAuth 설정
KAKAO_CLIENT_ID=your-rest-api-key-here
KAKAO_CLIENT_SECRET=your-client-secret-here
```

- `KAKAO_CLIENT_ID`: 4.1에서 복사한 REST API 키
- `KAKAO_CLIENT_SECRET`: 4.2에서 복사한 Client Secret

### 5.2 프로덕션 환경변수
배포 환경(Vercel, Netlify 등)의 환경변수 설정에도 동일하게 추가하세요.

---

## 6. 개발 서버 재시작

환경변수 변경 후 개발 서버를 재시작해야 합니다:

```bash
# 프론트엔드 서버 재시작
npm run dev
```

---

## 7. 테스트

### 7.1 로그인 테스트
1. 브라우저에서 `http://localhost:3000` 접속
2. 카카오 로그인 버튼 클릭
3. 카카오 로그인 페이지에서 로그인
4. 동의 항목 확인 후 동의
5. 앱으로 리디렉션되어 로그인 완료

### 7.2 테스터 등록 (앱 심사 전)
1. 카카오 개발자 콘솔에서 "앱 설정 > 테스트" 클릭
2. 테스트할 카카오 계정의 이메일 입력
3. "저장" 클릭
4. 해당 계정으로만 로그인 테스트 가능

### 7.3 확인 사항
- ✅ 카카오 로그인 후 프로필에 이름/이메일이 표시되는지 확인
- ✅ Supabase `users` 테이블에 사용자 정보가 저장되는지 확인
- ✅ 로그아웃 후 재로그인 시 기존 계정으로 로그인되는지 확인

---

## 8. 앱 심사 (선택)

앱을 일반 사용자에게 공개하려면 카카오 앱 심사를 받아야 합니다:

1. 좌측 메뉴에서 "앱 설정 > 비즈 앱" 클릭
2. 비즈 앱 전환 신청
3. 필요한 정보 입력 및 심사 요청
4. 심사 승인 후 모든 사용자가 로그인 가능

---

## 트러블슈팅

### 문제 1: "CLIENT_FETCH_ERROR" 발생
**원인**: 잘못된 API 키 또는 환경변수 미설정

**해결**:
1. `.env.development` 파일에 `KAKAO_CLIENT_ID`, `KAKAO_CLIENT_SECRET` 확인
2. 값이 올바른지 카카오 개발자 콘솔에서 다시 확인
3. 개발 서버 재시작

### 문제 2: "redirect_uri_mismatch" 에러
**원인**: Redirect URI 불일치

**해결**:
1. 카카오 개발자 콘솔에서 등록한 Redirect URI 확인
2. `http://localhost:3000/api/auth/callback/kakao` 정확히 일치하는지 확인
3. 후행 슬래시, 프로토콜(http/https) 확인

### 문제 3: "KOE006" 에러 (앱 심사 미승인)
**원인**: 테스터로 등록되지 않은 계정으로 로그인 시도

**해결**:
1. 카카오 개발자 콘솔에서 해당 계정을 테스터로 등록
2. 또는 앱 심사를 받아서 일반 공개

### 문제 4: 이메일 정보를 받지 못함
**원인**: 동의 항목 미설정 또는 사용자가 동의하지 않음

**해결**:
1. 카카오 개발자 콘솔에서 이메일을 필수 동의 항목으로 설정
2. 사용자가 다시 로그인하여 동의

---

## 참고 자료

- [카카오 로그인 공식 문서](https://developers.kakao.com/docs/latest/ko/kakaologin/common)
- [NextAuth.js Kakao Provider](https://next-auth.js.org/providers/kakao)
- [카카오 개발자 콘솔](https://developers.kakao.com/console)

---

## 추가 정보

### 카카오 로그인 버튼 디자인 가이드
카카오는 브랜드 가이드라인을 제공합니다:
- 배경색: `#FEE500` (카카오 옐로우)
- 텍스트 색: `#000000` (검정)
- 로고: [공식 리소스](https://developers.kakao.com/docs/latest/ko/reference/design-guide)에서 다운로드

### 프로덕션 체크리스트
- [ ] Redirect URI를 프로덕션 도메인으로 추가
- [ ] 프로덕션 환경변수에 API 키 설정
- [ ] HTTPS 사용 확인
- [ ] 앱 심사 완료 (일반 사용자 공개 시)
- [ ] 에러 로깅 설정
- [ ] 개인정보 처리방침 게시
